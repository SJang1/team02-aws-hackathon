<!DOCTYPE html>
<html>
<head>
    <title>CloudOptimizer - AWS 서비스 추천 플랫폼</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
        
        .navbar { background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); padding: 1rem 0; box-shadow: 0 2px 20px rgba(0,0,0,0.1); }
        .nav-container { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; padding: 0 2rem; }
        .logo { font-size: 1.5rem; font-weight: bold; color: #333; }
        .nav-links { display: flex; list-style: none; gap: 2rem; }
        .nav-links a { text-decoration: none; color: #333; font-weight: 500; transition: color 0.3s; }
        .nav-links a:hover { color: #667eea; }
        
        .hero { text-align: center; padding: 4rem 2rem; color: white; }
        .hero h1 { font-size: 3rem; margin-bottom: 1rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); opacity: 0; transform: translateY(30px); animation: fadeInScale 0.8s ease 0.1s forwards; }
        .hero p { font-size: 1.2rem; opacity: 0; max-width: 600px; margin: 0 auto; transform: translateY(20px); animation: fadeInScale 0.8s ease 0.3s forwards; }
        .hero-subtitle { margin-top: 1rem; }
        .hero-subtitle p { font-size: 1rem; opacity: 0; max-width: 700px; margin: 0 auto; transform: translateY(20px); animation: fadeInScale 0.8s ease 0.5s forwards; }
        
        .container { max-width: 800px; margin: 0 auto; padding: 2rem; }
        .card { background: white; border-radius: 20px; padding: 3rem; box-shadow: 0 20px 40px rgba(0,0,0,0.1); margin-top: -2rem; position: relative; z-index: 1; opacity: 0; transform: translateY(30px); animation: fadeInScale 0.8s ease 0.3s forwards; }
        
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group.full-width { grid-column: 1 / -1; }
        
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #333; font-size: 0.9rem; }
        select, input, textarea { width: 100%; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 12px; font-size: 1rem; transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); background: #f8f9fa; }
        select:hover, input:hover, textarea:hover { border-color: #c3d0ea; transform: translateY(-1px); }
        select:focus, input:focus, textarea:focus { outline: none; border-color: #667eea; background: white; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        
        .custom-input { display: none; margin-top: 0.5rem; }
        .custom-input.show { display: block; }
        #customResourceConfig { padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-top: 1rem; }
        #customResourceConfig label { margin-top: 0.5rem; margin-bottom: 0.3rem; font-size: 0.85rem; }
        #customResourceConfig input { margin-bottom: 0.5rem; }
        
        .submit-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 16px 32px; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; width: 100%; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); position: relative; overflow: hidden; }
        .submit-btn:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4); }
        .submit-btn:active { transform: translateY(-1px) scale(0.98); }
        .submit-btn::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: left 0.5s; }
        .submit-btn:hover::before { left: 100%; }
        
        .loading { margin-top: 2rem; padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; color: white; display: none; text-align: center; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; }
        .loading.show { opacity: 1; transform: translateY(0); }
        .result { margin-top: 2rem; padding: 2rem; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 16px; color: white; display: none; opacity: 0; transform: translateY(20px) scale(0.95); transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .result.show { opacity: 1; transform: translateY(0) scale(1); }
        .result.success { background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%); }
        .result.error { background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); }
        .service-item { background: rgba(255,255,255,0.1); margin: 0.5rem 0; padding: 1rem; border-radius: 8px; opacity: 0; transform: translateX(-20px); animation: slideInLeft 0.6s ease forwards; }
        .service-item:nth-child(2) { animation-delay: 0.1s; }
        .service-item:nth-child(3) { animation-delay: 0.2s; }
        .service-item:nth-child(4) { animation-delay: 0.3s; }
        .cost-summary { background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 8px; margin-top: 1rem; opacity: 0; transform: translateY(20px); animation: slideInUp 0.6s ease 0.4s forwards; }
        .spinner { border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 1rem; display: inline-block; }
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        @keyframes slideInLeft { to { opacity: 1; transform: translateX(0); } }
        @keyframes slideInUp { to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInScale { 0% { opacity: 0; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        
        .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; margin: 4rem 2rem; padding: 0 2rem; }
        .feature { background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 16px; text-align: center; color: white; opacity: 0; transform: translateY(30px); animation: fadeInScale 0.6s ease forwards; transition: transform 0.3s ease; }
        .feature:nth-child(1) { animation-delay: 0.1s; }
        .feature:nth-child(2) { animation-delay: 0.2s; }
        .feature:nth-child(3) { animation-delay: 0.3s; }
        .feature:hover { transform: translateY(-10px) scale(1.05); }
        .feature i { font-size: 3rem; margin-bottom: 1rem; }
        
        .guide-section { background: rgba(255,255,255,0.05); margin: 4rem 0; padding: 3rem 2rem; border-radius: 20px; }
        .guide-section h2 { text-align: center; color: white; font-size: 2rem; margin-bottom: 3rem; opacity: 0; transform: translateY(20px); animation: fadeInScale 0.8s ease 0.2s forwards; }
        .guide-steps { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; }
        .step { background: rgba(255,255,255,0.1); padding: 2rem; border-radius: 16px; text-align: center; color: white; opacity: 0; transform: translateY(30px); animation: fadeInScale 0.6s ease forwards; }
        .step:nth-child(1) { animation-delay: 0.3s; }
        .step:nth-child(2) { animation-delay: 0.4s; }
        .step:nth-child(3) { animation-delay: 0.5s; }
        .step-number { width: 50px; height: 50px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: bold; margin: 0 auto 1rem; }
        .step h3 { margin-bottom: 1rem; font-size: 1.3rem; }
        .step p { font-size: 0.95rem; line-height: 1.6; opacity: 0.9; }
        
        @media (max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .hero h1 { font-size: 2rem; }
            .nav-links { display: none; }
            .guide-steps { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo"><i class="fas fa-cloud"></i> ClOps</div>
            <ul class="nav-links">
                <li><a href="#" onclick="showTab('home')" class="nav-link active">홈</a></li>
                <li><a href="#" onclick="showTab('service')" class="nav-link">서비스</a></li>
                <li><a href="#" onclick="showTab('pricing')" class="nav-link">요금제</a></li>
                <li><a href="#" onclick="showTab('contact')" class="nav-link">문의</a></li>
            </ul>
        </div>
    </nav>
    
    <section class="hero">
        <h1><i class="fas fa-magic"></i> ClOps - AWS 서비스 추천 플랫폼</h1>
        <p>인디 개발자와 소규모 팀을 위한 AI 기반 AWS 아키텍처 추천 및 컨설팅 플랫폼</p>
        <div class="hero-subtitle">
            <p>갑작스러운 트래픽 급증에도 다운타임 없는 확장 가능한 인프라를 자동으로 설계해드립니다</p>
        </div>
    </section>
    
    <div class="features">
        <div class="feature">
            <i class="fas fa-robot"></i>
            <h3>AI 기반 분석</h3>
            <p>머신러닝으로 최적의 서비스 조합을 찾아드립니다</p>
        </div>
        <div class="feature">
            <i class="fas fa-dollar-sign"></i>
            <h3>비용 최적화</h3>
            <p>예산에 맞는 가장 효율적인 구성을 제안합니다</p>
        </div>
        <div class="feature">
            <i class="fas fa-chart-line"></i>
            <h3>성능 보장</h3>
            <p>요구사항에 맞는 성능을 보장하는 서비스를 추천합니다</p>
        </div>
    </div>
    
    <div class="container">
        <div class="card">
    
    <form id="estimateForm">
        <div class="form-group">
            <label for="serviceType">서비스 유형:</label>
            <select id="serviceType" required>
                <option value="">선택하세요</option>
                <option value="인디 게임">인디 게임</option>
                <option value="웹사이트/웹앱">웹사이트/웹앱</option>
                <option value="API 서버">API 서버</option>
                <option value="모바일 앱 백엔드">모바일 앱 백엔드</option>
                <option value="데이터 분석">데이터 분석</option>
                <option value="머신러닝/AI">머신러닝/AI</option>
                <option value="기타">기타</option>
            </select>
            <input type="text" id="customServiceType" class="custom-input" placeholder="서비스 유형을 직접 입력하세요">
            </select>
        </div>
        
            <div class="form-group">
                <label for="expectedUsers">예상 사용자 수:</label>
                <select id="expectedUsers" required>
                    <option value="">선택하세요</option>
                    <option value="소규모 (1-100명)">소규모 (1-100명)</option>
                    <option value="중간규모 (100-1,000명)">중간규모 (100-1,000명)</option>
                    <option value="대규모 (1,000-10,000명)">대규모 (1,000-10,000명)</option>
                    <option value="엔터프라이즈 (10,000명+)">엔터프라이즈 (10,000명+)</option>
                    <option value="기타">기타</option>
                </select>
                <input type="text" id="customExpectedUsers" class="custom-input" placeholder="사용자 수를 직접 입력하세요">
            </div>
        
            <div class="form-group">
                <label for="resourceAllocation">사용자당 리소스 할당:</label>
                <select id="resourceAllocation" required>
                    <option value="">선택하세요</option>
                    <option value="권장 자동 할당">권장 자동 할당 (AI 추천)</option>
                    <option value="사용자 지정">사용자 직접 설정</option>
                </select>
                <div id="customResourceConfig" class="custom-input">
                    <label for="cpuPerUser">CPU (GHz/사용자):</label>
                    <input type="number" id="cpuPerUser" step="0.1" min="0.1" placeholder="1.0">
                    <label for="memoryPerUser">메모리 (GB/사용자):</label>
                    <input type="number" id="memoryPerUser" step="0.1" min="0.1" placeholder="1.0">
                    <label for="storagePerUser">스토리지 (GB/사용자):</label>
                    <input type="number" id="storagePerUser" step="1" min="1" placeholder="10">
                </div>
            </div>
        
            <div class="form-group">
                <label for="region">AWS 리전:</label>
                <select id="region" required>
                    <option value="">선택하세요</option>
                    <option value="ap-northeast-2">서울 (ap-northeast-2)</option>
                    <option value="us-east-1">버지니아 북부 (us-east-1)</option>
                    <option value="us-west-2">오레곤 (us-west-2)</option>
                    <option value="ap-southeast-1">싱가포르 (ap-southeast-1)</option>
                    <option value="기타">기타</option>
                </select>
                <input type="text" id="customRegion" class="custom-input" placeholder="리전을 직접 입력하세요">
            </div>
        
            </div>
            
            <div class="form-group full-width">
                <label for="additionalInfo">추가 요구사항:</label>
                <textarea id="additionalInfo" rows="3" placeholder="특별한 요구사항이나 기능을 입력하세요 (선택사항)"></textarea>
            </div>
            
            <div class="form-group full-width">
                <label for="budget"><i class="fas fa-dollar-sign"></i> 월 예산 (USD):</label>
                <input type="number" id="budget" min="1" placeholder="100" required>
            </div>
            
            <button type="submit" class="submit-btn">
                <i class="fas fa-magic"></i> AWS 서비스 추천 받기
            </button>
        </div>
    </form>
    
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <h3><i class="fas fa-robot"></i> AI가 분석 중입니다...</h3>
            <p>최적의 AWS 서비스 구성을 찾고 있습니다. 잠시만 기다려주세요.</p>
        </div>
        
        <div id="result" class="result">
            <div id="result-content"></div>
        </div>
        </div>
        
        <div class="guide-section">
            <h2><i class="fas fa-compass"></i> 사용 가이드</h2>
            <div class="guide-steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>요구사항 입력</h3>
                    <p>서비스 종류(게임, 웹앱), 예상 사용자 수, 핵심 기능, 월 가용 예산 등 간단한 정보를 입력하세요.</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>AI 분석 및 설계</h3>
                    <p>전문화된 AI 에이전트들이 트래픽 패턴 예측, 아키텍처 설계, AWS 서비스 매핑을 순차적으로 수행합니다.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>결과 리포트 확인</h3>
                    <p>추천 아키텍처 다이어그램, 구성 가이드, 상세 비용 분석이 담긴 종합 리포트를 받아보세요.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 기타 옵션 선택 시 커스텀 입력 필드 보이기/숨기기
        function toggleCustomInput(selectId, customInputId) {
            const select = document.getElementById(selectId);
            const customInput = document.getElementById(customInputId);
            
            select.addEventListener('change', function() {
                if (this.value === '기타') {
                    customInput.classList.add('show');
                    customInput.required = true;
                } else {
                    customInput.classList.remove('show');
                    customInput.required = false;
                    customInput.value = '';
                }
            });
        }
        
        // 각 선택 상자에 대해 커스텀 입력 기능 활성화
        toggleCustomInput('serviceType', 'customServiceType');
        toggleCustomInput('expectedUsers', 'customExpectedUsers');
        toggleCustomInput('region', 'customRegion');
        
        // 리소스 할당 옵션 처리
        document.getElementById('resourceAllocation').addEventListener('change', function() {
            const customConfig = document.getElementById('customResourceConfig');
            if (this.value === '사용자 지정') {
                customConfig.classList.add('show');
                document.getElementById('cpuPerUser').required = true;
                document.getElementById('memoryPerUser').required = true;
                document.getElementById('storagePerUser').required = true;
            } else {
                customConfig.classList.remove('show');
                document.getElementById('cpuPerUser').required = false;
                document.getElementById('memoryPerUser').required = false;
                document.getElementById('storagePerUser').required = false;
            }
        });
        
        document.getElementById('estimateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // 버튼 애니메이션
            const submitBtn = document.querySelector('.submit-btn');
            submitBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                submitBtn.style.transform = '';
            }, 150);
            
            // 값 가져오기 (기타 선택 시 커스텀 입력값 사용)
            const serviceType = document.getElementById('serviceType').value === '기타' ? 
                document.getElementById('customServiceType').value : document.getElementById('serviceType').value;
            const expectedUsers = document.getElementById('expectedUsers').value === '기타' ? 
                document.getElementById('customExpectedUsers').value : document.getElementById('expectedUsers').value;
            
            // 리소스 할당 데이터 처리
            const resourceAllocation = document.getElementById('resourceAllocation').value;
            let resourceConfig = {};
            if (resourceAllocation === '사용자 지정') {
                resourceConfig = {
                    type: 'custom',
                    cpuPerUser: parseFloat(document.getElementById('cpuPerUser').value),
                    memoryPerUser: parseFloat(document.getElementById('memoryPerUser').value),
                    storagePerUser: parseInt(document.getElementById('storagePerUser').value)
                };
            } else {
                resourceConfig = { type: 'auto' };
            }
            const region = document.getElementById('region').value === '기타' ? 
                document.getElementById('customRegion').value : document.getElementById('region').value;
            const additionalInfo = document.getElementById('additionalInfo').value;
            const budget = document.getElementById('budget').value;
            
            // 부드러운 스크롤 애니메이션
            setTimeout(() => {
                showLoading();
                document.getElementById('loading').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }, 200);
            
            try {
                const response = await fetch('/optimize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        service_type: serviceType,
                        users: expectedUsers,
                        resource_config: resourceConfig,
                        additional_info: additionalInfo || '',
                        budget: parseInt(budget),
                        region: region 
                    })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    showError(`오류: ${data.error}`);
                    return;
                }
                
                const uuid = data.uuid;
                if (!uuid) {
                    showError('UUID를 받지 못했습니다.');
                    return;
                }
                
                pollResult(uuid);
            } catch (error) {
                showError('오류가 발생했습니다.');
            }
        });
        
        function showLoading() {
            const loading = document.getElementById('loading');
            const result = document.getElementById('result');
            
            result.classList.remove('show');
            setTimeout(() => {
                result.style.display = 'none';
                loading.style.display = 'block';
                setTimeout(() => loading.classList.add('show'), 10);
            }, 300);
        }
        
        function showResult(content, isSuccess = true) {
            const loading = document.getElementById('loading');
            const resultDiv = document.getElementById('result');
            
            loading.classList.remove('show');
            setTimeout(() => {
                loading.style.display = 'none';
                resultDiv.className = isSuccess ? 'result success' : 'result error';
                resultDiv.style.display = 'block';
                document.getElementById('result-content').innerHTML = content;
                setTimeout(() => resultDiv.classList.add('show'), 10);
            }, 300);
        }
        
        function showError(message) {
            showResult(`<h3><i class="fas fa-exclamation-triangle"></i> 오류</h3><p>${message}</p>`, false);
        }
        
        async function pollResult(uuid) {
            if (!uuid || uuid === 'undefined') {
                showError('잘못된 UUID입니다.');
                return;
            }
            
            try {
                const response = await fetch(`/status/${uuid}`);
                const data = await response.json();
                
                if (data.status === 'completed') {
                    if (data.feasible) {
                        let content = '<h3><i class="fas fa-check-circle"></i> 분석 완료!</h3>';
                        content += '<div class="services-list">';
                        data.services.forEach(service => {
                            content += `<div class="service-item">`;
                            content += `<strong>${service.name}</strong> (${service.type})`;
                            content += `<br><span>$${service.monthly_cost}/월 - ${service.reason}</span>`;
                            content += `</div>`;
                        });
                        content += '</div>';
                        content += `<div class="cost-summary">`;
                        content += `<h4>비용 요약</h4>`;
                        content += `<p><strong>총 비용: $${data.total_cost}/월</strong></p>`;
                        content += `<p>예산 내 절약: $${data.savings}</p>`;
                        content += `</div>`;
                        showResult(content, true);
                    } else {
                        showResult(`<h3><i class="fas fa-exclamation-triangle"></i> 예산 부족</h3><p>${data.message}</p>`, false);
                    }
                } else if (data.status === 'failed') {
                    showError('처리 실패');
                } else {
                    setTimeout(() => pollResult(uuid), 2000);
                }
            } catch (error) {
                showError('폴링 오류');
            }
        }
    </script>
</body>
</html>